# Verinode Media Storage Configuration
# Configuration for multimedia proof storage, compression, and optimization

storage:
  # Primary storage provider
  provider: ${STORAGE_PROVIDER:-local}
  
  # Local storage settings
  local:
    basePath: ${MEDIA_STORAGE_PATH:-./uploads/media}
    maxFileSize: 500MB
    allowedMimeTypes:
      - video/mp4
      - video/webm
      - video/quicktime
      - audio/mpeg
      - audio/wav
      - audio/webm
      - audio/ogg
    
  # AWS S3 settings
  s3:
    bucket: ${S3_BUCKET_NAME:-verinode-media}
    region: ${AWS_REGION:-us-east-1}
    accessKeyId: ${AWS_ACCESS_KEY_ID}
    secretAccessKey: ${AWS_SECRET_ACCESS_KEY}
    endpoint: ${S3_ENDPOINT:-https://s3.amazonaws.com}
    forcePathStyle: false
    
  # IPFS settings
  ipfs:
    gateway: ${IPFS_GATEWAY:-https://ipfs.io}
    apiUrl: ${IPFS_API_URL:-http://localhost:5001}
    pinata:
      apiKey: ${PINATA_API_KEY}
      secretKey: ${PINATA_SECRET_KEY}

# Compression settings
compression:
  enabled: true
  
  # Video compression
  video:
    enabled: true
    defaultCodec: H264
    codecs:
      H264:
        preset: medium
        crf: 23
        profile: high
        level: 4.1
      H265:
        preset: medium
        crf: 28
        profile: main
      VP9:
        cpuUsed: 1
        deadline: good
        threads: 4
    
    # Quality presets
    qualities:
      low:
        resolution: 640x480
        bitrate: 500000
        fps: 24
      medium:
        resolution: 1280x720
        bitrate: 2500000
        fps: 30
      high:
        resolution: 1920x1080
        bitrate: 5000000
        fps: 30
      ultra:
        resolution: 3840x2160
        bitrate: 20000000
        fps: 60
    
    # Audio settings
    audio:
      codec: AAC
      bitrate: 128000
      sampleRate: 44100
      channels: 2
  
  # Audio compression
  audio:
    enabled: true
    codecs:
      - AAC
      - MP3
      - OPUS
    bitrates:
      low: 64000
      medium: 128000
      high: 256000

# Watermarking settings
watermark:
  enabled: true
  
  # Visible watermark
  visible:
    enabled: true
    text: ${WATERMARK_TEXT:-Verified by Verinode}
    position: bottom-right
    offset:
      x: 20
      y: 20
    font:
      family: Arial
      size: 24
      color: rgba(255, 255, 255, 0.7)
    background:
      enabled: true
      color: rgba(0, 0, 0, 0.3)
      padding: 8
  
  # Invisible watermark (steganography)
  invisible:
    enabled: true
    algorithm: DCT
    strength: 0.5
    spreadSpectrum: true

# Authenticity verification
authenticity:
  enabled: true
  
  # Hash algorithm
  hashAlgorithm: SHA-256
  
  # Digital signature
  signature:
    algorithm: ECDSA
    curve: P-256
    keyRotationDays: 90
  
  # Certificate settings
  certificate:
    validityDays: 365
    issuer: Verinode Media Authority

# Media processing
processing:
  # Thumbnail generation
  thumbnails:
    enabled: true
    sizes:
      small:
        width: 160
        height: 90
      medium:
        width: 320
        height: 180
      large:
        width: 640
        height: 360
    format: JPEG
    quality: 85
  
  # Preview generation
  preview:
    enabled: true
    duration: 5
    fps: 10
    maxSize: 5MB
  
  # Metadata extraction
  metadata:
    enabled: true
    extract:
      - duration
      - resolution
      - bitrate
      - codec
      - frameRate
      - creationDate
      - location
      - device
    stripSensitive: true

# CDN configuration
cdn:
  enabled: ${CDN_ENABLED:-false}
  provider: ${CDN_PROVIDER:-cloudfront}
  
  cloudfront:
    domain: ${CLOUDFRONT_DOMAIN}
    keyPairId: ${CLOUDFRONT_KEY_PAIR_ID}
    privateKey: ${CLOUDFRONT_PRIVATE_KEY}
  
  cloudflare:
    zoneId: ${CLOUDFLARE_ZONE_ID}
    apiToken: ${CLOUDFLARE_API_TOKEN}

# Caching settings
cache:
  enabled: true
  
  # Browser cache
  browser:
    maxAge: 31536000
    immutable: true
  
  # CDN cache
  cdn:
    maxAge: 86400
    staleWhileRevalidate: 604800
  
  # Server cache
  server:
    type: redis
    ttl: 3600
    maxSize: 1GB

# Upload settings
upload:
  # Chunked upload
  chunked:
    enabled: true
    chunkSize: 5MB
    maxConcurrent: 3
  
  # Resumable upload
  resumable:
    enabled: true
    expirationMinutes: 60
  
  # Virus scanning
  virusScan:
    enabled: true
    engine: ${VIRUS_SCAN_ENGINE:-clamav}
    timeout: 300
  
  # Content validation
  validation:
    maxFileSize: 500MB
    allowedExtensions:
      - mp4
      - webm
      - mov
      - mp3
      - wav
      - ogg
      - m4a

# Retention policies
retention:
  # Default retention period
  defaultDays: 365
  
  # Tiered storage
  tiers:
    hot:
      days: 30
      storageClass: STANDARD
    warm:
      days: 90
      storageClass: STANDARD_IA
    cold:
      days: 365
      storageClass: GLACIER
    archive:
      days: 2555
      storageClass: DEEP_ARCHIVE
  
  # Auto-deletion
  autoDelete:
    enabled: false
    afterDays: 2555

# Security
security:
  # Encryption at rest
  encryption:
    enabled: true
    algorithm: AES-256-GCM
    keyManagement: ${KEY_MANAGEMENT:-aws-kms}
  
  # Encryption in transit
  tls:
    minVersion: '1.2'
    cipherSuites:
      - TLS_AES_256_GCM_SHA384
      - TLS_CHACHA20_POLY1305_SHA256
  
  # Access control
  accessControl:
    signedUrls:
      enabled: true
      expirationMinutes: 60
    
    ipWhitelist:
      enabled: false
      allowed: []
    
    rateLimit:
      enabled: true
      requestsPerMinute: 100

# Monitoring
monitoring:
  # Metrics collection
  metrics:
    enabled: true
    interval: 60
    
  # Health checks
  healthCheck:
    enabled: true
    interval: 30
    timeout: 10
  
  # Alerts
  alerts:
    enabled: true
    channels:
      - email
      - slack
    thresholds:
      storageUsage: 80
      errorRate: 5
      latency: 1000

# Backup configuration
backup:
  enabled: true
  
  # Backup schedule
  schedule:
    frequency: daily
    time: '02:00'
    timezone: UTC
  
  # Backup retention
  retention:
    daily: 7
    weekly: 4
    monthly: 12
  
  # Cross-region replication
  replication:
    enabled: false
    regions: []
